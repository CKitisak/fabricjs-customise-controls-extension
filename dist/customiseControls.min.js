!function(a){"use strict";var b=a.fabric||(a.fabric={}),c=function(){return"undefined"!=typeof G_vmlCanvasManager},d=b.util.degreesToRadians,e=[1,2,3,4,5,6,7,8];b.util.object.extend(b.Object.prototype,{useImageIcons:!1,setCustomCorner:function(a){this.useImageIcons=!0;var c,d,e=this;for(c in a)if(a.hasOwnProperty(c))switch(c){case"tl":d=new Image,d.onload=function(){e.tlIcon=this},d.onerror=function(){b.warn(this.src+"icon is not an image")},d.src=a[c];break;case"tr":d=new Image,d.onload=function(){e.trIcon=this},d.onerror=function(){b.warn(this.src+"icon is not an image")},d.src=a[c];break;case"bl":d=new Image,d.onload=function(){e.blIcon=this},d.onerror=function(){b.warn(this.src+"icon is not an image")},d.src=a[c];break;case"br":d=new Image,d.onload=function(){e.brIcon=this},d.onerror=function(){b.warn(this.src+"icon is not an image")},d.src=a[c];break;case"mt":d=new Image,d.onload=function(){e.mtIcon=this},d.onerror=function(){b.warn(this.src+"icon is not an image")},d.src=a[c];break;case"mb":d=new Image,d.onload=function(){e.mbIcon=this},d.onerror=function(){b.warn(this.src+"icon is not an image")},d.src=a[c];break;case"mr":d=new Image,d.onload=function(){e.mrIcon=this},d.onerror=function(){b.warn(this.src+"icon is not an image")},d.src=a[c];break;case"ml":d=new Image,d.onload=function(){e.mlIcon=this},d.onerror=function(){b.warn(this.src+"icon is not an image")},d.src=a[c];break;case"mtr":d=new Image,d.onload=function(){e.mtrIcon=this},d.onerror=function(){b.warn(this.src+"icon is not an image")},d.src=a[c]}},drawControls:function(a){if(!this.hasControls)return this;var b,c=this._calculateCurrentDimensions(!0),d=c.x,e=c.y,f=-(d/2),g=-(e/2),h=this.cornerSize/2;return this.useImageIcons?b="drawImage":(a.lineWidth=1,a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=a.fillStyle=this.cornerColor,b=this.transparentCorners?"strokeRect":"fillRect"),a.save(),this._drawControl("tl",a,b,f-h,g-h,this.tlIcon),this._drawControl("tr",a,b,f+d-h,g-h,this.trIcon),this._drawControl("bl",a,b,f-h,g+e-h,this.blIcon),this._drawControl("br",a,b,f+d-h,g+e-h,this.brIcon),this.get("lockUniScaling")||(this._drawControl("mt",a,b,f+d/2-h,g-h,this.mtIcon),this._drawControl("mb",a,b,f+d/2-h,g+e-h,this.mbIcon),this._drawControl("mr",a,b,f+d-h,g+e/2-h,this.mrIcon),this._drawControl("ml",a,b,f-h,g+e/2-h,this.mlIcon)),this.hasRotatingPoint&&this._drawControl("mtr",a,b,f+d/2-h,g-this.rotatingPointOffset-h,this.mtrIcon),a.restore(),this},_drawControl:function(a,b,d,e,f,g){if(this.isControlVisible(a)){var h=this.cornerSize;this.useImageIcons?void 0!==g&&b[d](g,e,f,h,h):(c()||this.transparentCorners||b.clearRect(e,f,h,h),b[d](e,f,h,h))}}}),b.util.object.extend(b.Canvas.prototype,{overwriteActions:!1,setCustomActions:function(a){var b,c=this;this.overwriteActions=!0;for(b in a)if(a.hasOwnProperty(b))switch(b){case"tl":c.tlAction=a[b];break;case"tr":c.trAction=a[b];break;case"bl":c.blAction=a[b];break;case"br":c.brAction=a[b];break;case"mt":c.mtAction=a[b];break;case"mb":c.mbAction=a[b];break;case"mr":c.mrAction=a[b];break;case"ml":c.mlAction=a[b];break;case"mtr":c.mtrAction=a[b]}},_getActionFromCorner:function(a,b){var c="drag";return b?c=this.overwriteActions?"ml"===b?this.mlAction||"scaleX":"mr"===b?this.mrAction||"scaleX":"mt"===b?this.mtAction||"scaleY":"mb"===b?this.mbAction||"scaleY":"tr"===b?this.trAction||"scale":"tl"===b?this.tlAction||"scale":"bl"===b?this.blAction||"scale":"br"===b?this.brAction||"scale":"mtr"===b?this.mtrAction||"rotate":"scale":"ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":"scale":void 0},_setupCurrentTransform:function(a,b){if(b){var c=this.getPointer(a),e=b._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(b,e),g=this._getOriginFromCorner(b,e);this._currentTransform={target:b,action:f,scaleX:b.scaleX,scaleY:b.scaleY,offsetX:c.x-b.left,offsetY:c.y-b.top,originX:g.x,originY:g.y,ex:c.x,ey:c.y,left:b.left,top:b.top,theta:d(b.angle),width:b.width*b.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:b.left,top:b.top,scaleX:b.scaleX,scaleY:b.scaleY,originX:g.x,originY:g.y},"remove"===f&&this._removeAction(a,b),this._resetCurrentTransform(a)}},_removeAction:function(a,b){this.getActiveGroup()&&"undefined"!=this.getActiveGroup()?(this.getActiveGroup().forEachObject(function(a){a.remove()}),this.discardActiveGroup()):b.remove()},fixedCursors:!1,setCustomCornerCursor:function(a){var b;this.fixedCursors=!0;for(b in a)if(a.hasOwnProperty(b))switch(b){case"tl":this.tlcursorIcon=a[b];break;case"tr":this.trcursorIcon=a[b];break;case"bl":this.blcursorIcon=a[b];break;case"br":this.brcursorIcon=a[b];break;case"mt":this.mtcursorIcon=a[b];break;case"mb":this.mbcursorIcon=a[b];break;case"mr":this.mrcursorIcon=a[b];break;case"ml":this.mlcursorIcon=a[b];break;case"mtr":this.mtrcursorIcon=a[b]}},_setCornerCursor:function(a,b){var c=/\.(?:jpe?g|png|gif|jpg|jpeg|svg)$/;if(this.fixedCursors)switch(a){case"tl":this.tlcursorIcon?c.test(this.tlcursorIcon)?this.setCursor("url("+this.tlcursorIcon+"), auto"):"resize"===this.tlcursorIcon?this._setScalingCursor(a,b):this.setCursor(this.tlcursorIcon):this._setScalingCursor(a,b);break;case"tr":this.trcursorIcon?c.test(this.trcursorIcon)?this.setCursor("url("+this.trcursorIcon+"), auto"):"resize"===this.trcursorIcon?this._setScalingCursor(a,b):this.setCursor(this.trcursorIcon):this._setScalingCursor(a,b);break;case"bl":this.blcursorIcon?c.test(this.blcursorIcon)?this.setCursor("url("+this.blcursorIcon+"), auto"):"resize"===this.blcursorIcon?this._setScalingCursor(a,b):this.setCursor(this.blcursorIcon):this._setScalingCursor(a,b);break;case"br":this.brcursorIcon?c.test(this.brcursorIcon)?this.setCursor("url("+this.brcursorIcon+"), auto"):"resize"===this.brcursorIcon?this._setScalingCursor(a,b):this.setCursor(this.brcursorIcon):this._setScalingCursor(a,b);break;case"mt":this.mtcursorIcon?c.test(this.mtcursorIcon)?this.setCursor("url("+this.mtcursorIcon+"), auto"):"resize"===this.mtcursorIcon?this._setScalingCursor(a,b):this.setCursor(this.mtcursorIcon):this._setScalingCursor(a,b);break;case"mb":this.mbcursorIcon?c.test(this.mbcursorIcon)?this.setCursor("url("+this.mbcursorIcon+"), auto"):"resize"===this.mbcursorIcon?this._setScalingCursor(a,b):this.setCursor(this.mbcursorIcon):this._setScalingCursor(a,b);break;case"mr":this.mrcursorIcon?c.test(this.mrcursorIcon)?this.setCursor("url("+this.mrcursorIcon+"), auto"):"resize"===this.mrcursorIcon?this._setScalingCursor(a,b):this.setCursor(this.mrcursorIcon):this._setScalingCursor(a,b);break;case"ml":this.mlcursorIcon?c.test(this.mlcursorIcon)?this.setCursor("url("+this.mlcursorIcon+"), auto"):"resize"===this.mlcursorIcon?this._setScalingCursor(a,b):this.setCursor(this.mlcursorIcon):this._setScalingCursor(a,b);break;case"mtr":this.mtrcursorIcon?c.test(this.mtrcursorIcon)?this.setCursor("url("+this.mtrcursorIcon+"), auto"):"resize"===this.mtrcursorIcon?this._setScalingCursor(a,b):this.setCursor(this.mtrcursorIcon):this._setScalingCursor(a,b)}else if(a in e)this.setCursor(this._getRotatedCornerCursor(a,b));else{if("mtr"!==a||!b.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_setScalingCursor:function(a,b){this.setCursor(this._getRotatedCornerCursor(a,b))}})}("undefined"!=typeof exports?exports:this);
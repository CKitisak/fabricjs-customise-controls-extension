!function(r){"use strict";var t=r.fabric||(r.fabric={}),s=function(){return"undefined"!=typeof G_vmlCanvasManager},o=t.util.degreesToRadians,i=[1,2,3,4,5,6,7,8];t.util.object.extend(t.Object.prototype,{useImageIcons:!1,setCustomCorner:function(r,s){var o=this,i=new Image;switch(r){case"tl":i.onload=function(){o.tlIcon=i},i.onerror=function(){t.warn(r+"icon is not an image")},i.src=s;break;case"tr":i.onload=function(){o.trIcon=i},i.onerror=function(){t.warn(r+"icon is not an image")},i.src=s;break;case"bl":i.onload=function(){o.blIcon=i},i.onerror=function(){t.warn(r+"icon is not an image")},i.src=s;break;case"br":i.onload=function(){o.brIcon=i},i.onerror=function(){t.warn(r+"icon is not an image")},i.src=s;break;case"mt":i.onload=function(){o.mtIcon=i},i.onerror=function(){t.warn(r+"icon is not an image")},i.src=s;break;case"mb":i.onload=function(){o.mbIcon=i},i.onerror=function(){t.warn(r+"icon is not an image")},i.src=s;break;case"mr":i.onload=function(){o.mrIcon=i},i.onerror=function(){t.warn(r+"icon is not an image")},i.src=s;break;case"ml":i.onload=function(){o.mlIcon=i},i.onerror=function(){t.warn(r+"icon is not an image")},i.src=s;break;case"mtr":i.onload=function(){o.mtrIcon=i},i.onerror=function(){t.warn(r+"icon is not an image")},i.src=s}},drawControls:function(r){if(!this.hasControls)return this;var t,s=this._calculateCurrentDimensions(!0),o=s.x,i=s.y,n=-(o/2),e=-(i/2),c=this.cornerSize/2;return this.useImageIcons?t="drawImage":(r.lineWidth=1,r.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,r.strokeStyle=r.fillStyle=this.cornerColor,t=this.transparentCorners?"strokeRect":"fillRect"),r.save(),this._drawControl("tl",r,t,n-c,e-c,this.tlIcon),this._drawControl("tr",r,t,n+o-c,e-c,this.trIcon),this._drawControl("bl",r,t,n-c,e+i-c,this.blIcon),this._drawControl("br",r,t,n+o-c,e+i-c,this.brIcon),this.get("lockUniScaling")||(this._drawControl("mt",r,t,n+o/2-c,e-c,this.mtIcon),this._drawControl("mb",r,t,n+o/2-c,e+i-c,this.mbIcon),this._drawControl("mr",r,t,n+o-c,e+i/2-c,this.mrIcon),this._drawControl("ml",r,t,n-c,e+i/2-c,this.mlIcon)),this.hasRotatingPoint&&this._drawControl("mtr",r,t,n+o/2-c,e-this.rotatingPointOffset-c,this.mtrIcon),r.restore(),this},_drawControl:function(r,t,o,i,n,e){if(this.isControlVisible(r)){var c=this.cornerSize;this.useImageIcons?void 0!==e&&t[o](e,i,n,c,c):(s()||this.transparentCorners||t.clearRect(i,n,c,c),t[o](i,n,c,c))}}}),t.util.object.extend(t.Canvas.prototype,{overwriteActions:!1,setCustomActions:function(r,t){switch(r){case"tl":this.tlAction=t;break;case"tr":this.trAction=t;break;case"bl":this.blAction=t;break;case"br":this.brAction=t;break;case"mt":this.mtAction=t;break;case"mb":this.mbAction=t;break;case"mr":this.mrAction=t;break;case"ml":this.mlAction=t;break;case"mtr":this.mtrAction=t}},_getActionFromCorner:function(r,t){var s="drag";return t?s=this.overwriteActions?"ml"===t?this.mlAction||"scaleX":"mr"===t?this.mrAction||"scaleX":"mt"===t?this.mtAction||"scaleY":"mb"===t?this.mbAction||"scaleY":"tr"===t?this.trAction||"scale":"tl"===t?this.tlAction||"scale":"bl"===t?this.blAction||"scale":"br"===t?this.brAction||"scale":"mtr"===t?this.mtrAction||"rotate":"scale":"ml"===t||"mr"===t?"scaleX":"mt"===t||"mb"===t?"scaleY":"mtr"===t?"rotate":"scale":void 0},_setupCurrentTransform:function(r,t){if(t){var s=this.getPointer(r),i=t._findTargetCorner(this.getPointer(r,!0)),n=this._getActionFromCorner(t,i),e=this._getOriginFromCorner(t,i);this._currentTransform={target:t,action:n,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:s.x-t.left,offsetY:s.y-t.top,originX:e.x,originY:e.y,ex:s.x,ey:s.y,left:t.left,top:t.top,theta:o(t.angle),width:t.width*t.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,originX:e.x,originY:e.y},"remove"===n&&this._removeAction(r,t),this._resetCurrentTransform(r)}},_removeAction:function(r,t){this.getActiveGroup()&&"undefined"!=this.getActiveGroup()?(this.getActiveGroup().forEachObject(function(r){r.remove()}),this.discardActiveGroup()):t.remove()},fixedCursors:!1,setCustomCornerCursor:function(r,t){switch(r){case"tl":this.tlcursorIcon=t;break;case"tr":this.trcursorIcon=t;break;case"bl":this.blcursorIcon=t;break;case"br":this.brcursorIcon=t;break;case"mt":this.mtcursorIcon=t;break;case"mb":this.mbcursorIcon=t;break;case"mr":this.mrcursorIcon=t;break;case"ml":this.mlcursorIcon=t;break;case"mtr":this.mtrcursorIcon=t}},_setCornerCursor:function(r,t){var s=/\.(?:jpe?g|png|gif|jpg|jpeg|svg)$/;if(this.fixedCursors)switch(r){case"tl":this.tlcursorIcon?s.test(this.tlcursorIcon)?this.setCursor("url("+this.tlcursorIcon+"), auto"):"resize"===this.tlcursorIcon?this._setScalingCursor(r,t):this.setCursor(this.tlcursorIcon):this._setScalingCursor(r,t);break;case"tr":this.trcursorIcon?s.test(this.trcursorIcon)?this.setCursor("url("+this.trcursorIcon+"), auto"):"resize"===this.trcursorIcon?this._setScalingCursor(r,t):this.setCursor(this.trcursorIcon):this._setScalingCursor(r,t);break;case"bl":this.blcursorIcon?s.test(this.blcursorIcon)?this.setCursor("url("+this.blcursorIcon+"), auto"):"resize"===this.blcursorIcon?this._setScalingCursor(r,t):this.setCursor(this.blcursorIcon):this._setScalingCursor(r,t);break;case"br":this.brcursorIcon?s.test(this.brcursorIcon)?this.setCursor("url("+this.brcursorIcon+"), auto"):"resize"===this.brcursorIcon?this._setScalingCursor(r,t):this.setCursor(this.brcursorIcon):this._setScalingCursor(r,t);break;case"mt":this.mtcursorIcon?s.test(this.mtcursorIcon)?this.setCursor("url("+this.mtcursorIcon+"), auto"):"resize"===this.mtcursorIcon?this._setScalingCursor(r,t):this.setCursor(this.mtcursorIcon):this._setScalingCursor(r,t);break;case"mb":this.mbcursorIcon?s.test(this.mbcursorIcon)?this.setCursor("url("+this.mbcursorIcon+"), auto"):"resize"===this.mbcursorIcon?this._setScalingCursor(r,t):this.setCursor(this.mbcursorIcon):this._setScalingCursor(r,t);break;case"mr":this.mrcursorIcon?s.test(this.mrcursorIcon)?this.setCursor("url("+this.mrcursorIcon+"), auto"):"resize"===this.mrcursorIcon?this._setScalingCursor(r,t):this.setCursor(this.mrcursorIcon):this._setScalingCursor(r,t);break;case"ml":this.mlcursorIcon?s.test(this.mlcursorIcon)?this.setCursor("url("+this.mlcursorIcon+"), auto"):"resize"===this.mlcursorIcon?this._setScalingCursor(r,t):this.setCursor(this.mlcursorIcon):this._setScalingCursor(r,t);break;case"mtr":this.mtrcursorIcon?s.test(this.mtrcursorIcon)?this.setCursor("url("+this.mtrcursorIcon+"), auto"):"resize"===this.mtrcursorIcon?this._setScalingCursor(r,t):this.setCursor(this.mtrcursorIcon):this._setScalingCursor(r,t)}else if(r in i)this.setCursor(this._getRotatedCornerCursor(r,t));else{if("mtr"!==r||!t.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_setScalingCursor:function(r,t){this.setCursor(this._getRotatedCornerCursor(r,t))}})}("undefined"!=typeof exports?exports:this);
